<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="club">
	<select id="selectOne" resultType="Member">
		select * from member where member_id=#{member_id}
	</select>
	<resultMap type="Club" id="clubMain">
		
	</resultMap>
	<select id="selectClub" resultMap="clubMain">
		select * from circle where circle_num=#{circle_num}
	</select>
	<resultMap type="Member" id="club"></resultMap>
	<select id="selectMember" resultMap="club">
		select * from member where circle1_num=#{circle_num}
	</select>
	<insert id="insertBoard" parameterType="cBoard">
		insert into circle_board values(
			CIRCLE_BOARD_SEQ.NEXTVAL,
			#{cb_title},
			#{cb_content},
			#{cb_attachment},
			0,
			#{member_id},
			#{circle_num},
			#{cb_attachment2},
			sysdate,
			#{cb_reattachment},
			#{cb_reattachment2}
		)
	</insert>
	<select id="selectBoardList" resultType="cBoard">
		SELECT * FROM CIRCLE_BOARD WHERE CIRCLE_NUM=#{circle_num} ORDER BY CB_NUM DESC
	</select>
	<delete id="deleteBoard">
		DELETE FROM CIRCLE_BOARD WHERE CB_NUM=#{cb_num}
	</delete>
	<select id="selectBoardOne" resultType="cBoard">
		SELECT * FROM CIRCLE_BOARD WHERE CB_NUM=#{no}
	</select>
	<update id="updateBoard" parameterType="cBoard">
	UPDATE CIRCLE_BOARD SET CB_TITLE=#{cb_title},CB_CONTENT=#{cb_content} WHERE CB_NUM=#{cb_num}
	</update>
	
	<select id='selectMatching' parameterType="_int" resultType='com.yj.project.calendar.model.vo.Matching'>
	select req_withus.*,circle.circle_name,circle.circle_photo  from req_withus full outer JOIN circle ON req_withus.REQ_CIRCLE=circle.circle_num where req_withus.REGISTER_CIRCLE=#{circle1_num} and req_withus.status in('S','C')
	</select>

	<update id="deleteMember">
		UPDATE MEMBER SET CIRCLE1_NUM=0 WHERE MEMBER_ID=#{id} 
	</update>
	<insert id="insertBudget" parameterType="budget">
		INSERT INTO CIRCLE_BUDGET VALUES(CIRCLE_BUDGET_SEQ.NEXTVAL,#{circle_num},#{member_id},#{budget_content},#{attachment},#{budget_input},#{budget_output},#{used_date},sysdate,#{reattachment})
	</insert>
	<resultMap type="budget" id="insertBud">
		<id property="budget_no" column="budget_num"/>
		<result property="attachment" column="budget_attachment"/>
		<result property="reattachment" column="budget_reattachment"/>
	</resultMap>
	<select id="selectBudgetList" resultMap="insertBud">
		SELECT * FROM CIRCLE_BUDGET WHERE CIRCLE_NUM=#{circle_num} ORDER BY BUDGET_NUM DESC
	</select>
	<select id="selectMemberCount" resultType="_int">
		SELECT COUNT(*) FROM MEMBER WHERE CIRCLE1_NUM=#{circle_num}
	</select>
	<select id="selectCountBudget" resultType="_int">
		SELECT COUNT(*) FROM CIRCLE_BUDGET WHERE CIRCLE_NUM=#{circle_num}
	</select>
	<insert id="insertComment">
		INSERT INTO CB_COMMENT VALUES(CB_COMMENT_SEQ.NEXTVAL,#{cb_num},#{member_id},#{cb_comment_content},sysdate)
	</insert>
	
	<select id="commentList" resultType="cb_comment">
		SELECT * FROM CB_COMMENT ORDER BY CB_COMMENTNO DESC
	</select>

	<select id='selectFinal' parameterType="_int" resultType='com.yj.project.calendar.model.vo.FinalWithus'>
	select final_withus.*,circle.circle_name from final_withus full outer JOIN circle ON final_withus.req_CIRCLE=circle.circle_num where register_circle = #{circle1_num}
	</select>
	<select id='selectNotice' parameterType="_int" resultType='com.yj.project.calendar.model.vo.ClubNotice'>
	select * from club_notice where circle_num = #{circle1_num} order by rownum desc
	</select>

	<select id='countNotice' parameterType="map" resultType="_int">
	select count(*) from club_notice where circle_num = #{circle_num}
	</select>
	
	<update id="noticeUpdate" parameterType="string">
	update member set member_notice = 0 where member_id = #{member_id}
	</update>
	<select id="selectGalleryList" resultType="_int">
		SELECT COUNT(CB_ATTACHMENT)
	</select>
	<select id="selectG1" resultType="string" >
		SELECT CB_REATTACHMENT FROM CIRCLE_BOARD WHERE CIRCLE_NUM=#{circle_num}
	</select>
	<select id="selectG2" resultType="string" >
		SELECT CB_REATTACHMENT2 FROM CIRCLE_BOARD WHERE CIRCLE_NUM=#{circle_num}
	</select>
	<delete id="deleteComment">
		DELETE FROM CB_COMMENT WHERE CB_COMMENTNO=#{no}
	</delete>
	<insert id="like_check">
		insert into INNERLIKE values (INNERLIKE_SEQ.NEXTVAL,#{member_id},#{cb_no},1)
	</insert>
	<select id="selectLike" resultType="innerlike">
		select * from INNERLIKE where member_id=#{member_id} and cb_no=#{cb_no}
	</select>
	<update id="updateDislike">
		UPDATE INNERLIKE SET CB_LIKE_CHECK=0 WHERE member_id=#{member_id} and cb_no=#{cb_no}
	</update>
	<update id="updateLike">
		UPDATE INNERLIKE SET CB_LIKE_CHECK=1 WHERE member_id=#{member_id} and cb_no=#{cb_no}
	</update>
	<select id="selectLikeList" resultType="innerlike">
		SELECT * FROM INNERLIKE WHERE MEMBER_ID=#{member_id}
	</select>
	<update id="updateLevel">
		UPDATE MEMBER SET MEMBER_LEVEL=#{member_level} WHERE MEMBER_ID=#{member_id}
	</update>
	<insert id='createClub' parameterType="com.yj.project.club.model.vo.ReqCircle">
	insert into circle_register values(circle_register_seq.nextval,#{circle_name},#{university},#{circle_adviser},#{member_id},'L2',#{circle_phone},sysdate,#{circle_photo},#{category},#{circle_comment},0)
	</insert>
	<select id='selectClubCreate' resultType="com.yj.project.club.model.vo.ReqCircle">
	select * from circle_register order by circle_num asc
	</select>
	<select id="selectComment" resultType="cb_comment">
		SELECT * FROM CB_COMMENT WHERE CB_NUM=#{no} and CB_COMMENTNO = (select MAX(CB_COMMENTNO) from CB_COMMENT where CB_NUM=#{cb_num})
	</select>
</mapper>
